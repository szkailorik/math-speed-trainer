# 产品需求文档 (PRD)

## 项目：小九九表 - 怪兽战斗模式

### 版本：v1.1
### 日期：2026-02-05
### 状态：产品经理评审完成

---

## 1. 需求背景

当前小九九模块采用传统答题模式，缺乏游戏化元素。为提升小学生的学习兴趣和参与度，需要引入怪兽战斗机制，将数学练习转化为闯关游戏体验。

### 1.1 问题分析
- 8-10岁儿童注意力持续时间约15-20分钟，传统答题模式容易产生疲劳
- 小九九（特别是6-9区间）是学习难点，需要大量重复练习才能熟练
- 单纯的对错反馈缺乏即时满足感和成就感
- 现有连胜机制虽好，但缺少"打怪升级"的游戏叙事

### 1.2 目标
- 提升单次练习时长 30%+
- 提高每日活跃练习次数
- 降低错题率（通过更有动力的重复练习）

## 2. 目标用户

- **主要用户**：小学3-4年级学生（Lorik 和 Kai）
- **年龄范围**：8-10岁
- **用户特征**：
  - 喜欢游戏化体验，对"打怪"概念熟悉
  - 有一定的竞争心理，喜欢挑战和成就
  - 对可爱的角色和视觉效果反应积极
  - 需要即时反馈和正向激励

## 3. 核心功能需求

### 3.1 战斗场景布局

| 元素 | 描述 | 实现方式 |
|------|------|----------|
| 顶部区域 | 怪兽显示区：怪兽emoji + 血条 + 关卡信息 | 固定高度，居中显示 |
| 中部区域 | 题目显示区 + 武器发射动画区 | 复用现有题目卡片样式 |
| 底部区域 | 答题区 + 玩家状态（血条+连击数） | 复用现有选择按钮 |

**布局示意：**
```
┌────────────────────────┐
│  [关卡 1/4]  [BOSS名]  │
│                        │
│      [怪兽 emoji]      │
│   ████████░░ HP: 3/5   │
├────────────────────────┤
│                        │
│     [武器飞行区域]     │
│                        │
├────────────────────────┤
│      6 × 7 = ?         │
├────────────────────────┤
│  [42] [48] [36] [54]   │
│                        │
│   ❤️❤️❤️░░  连击: 3     │
└────────────────────────┘
```

### 3.2 怪兽系统

#### 怪兽设计（使用emoji实现）

| 关卡 | 怪兽名称 | Emoji | 特点描述 | HP |
|------|----------|-------|----------|-----|
| 1 | 数字史莱姆 | 🟢 或 🫠 | 最弱的小怪，让孩子建立信心 | 3 |
| 2 | 调皮小鬼 | 👻 | 会"躲闪"（答对后有小概率闪避动画） | 4 |
| 3 | 骷髅数学家 | 💀 | 普通难度，稳定挑战 | 5 |
| 4 | 火焰龙宝宝 | 🐲 | 最终BOSS，击败后有大庆祝 | 6 |

**困难模式额外关卡：**
| 关卡 | 怪兽名称 | Emoji | HP |
|------|----------|-------|-----|
| 5 | 冰霜巨人 | 🧊 | 7 |
| 6 | 九九魔王 | 👹 | 8 |

#### 怪兽状态动画（CSS实现）
- **待机**：轻微上下浮动（transform: translateY + animation）
- **受击**：左右抖动 + 短暂变红/闪白
- **攻击**：放大 + 前冲动画
- **死亡**：旋转缩小 + 渐隐消失 + 爆炸emoji特效

### 3.3 武器系统

**决定：采用随机武器，不设武器选择功能**

理由：
1. 减少操作复杂度，让孩子专注于答题
2. 随机武器增加惊喜感和趣味性
3. 简化开发和界面设计

| 武器 | Emoji | 出现概率 | 特效描述 |
|------|-------|----------|----------|
| 火球 | 🔥 | 25% | 默认攻击，橙红色轨迹 |
| 冰箭 | 🧊 | 20% | 蓝色轨迹，怪兽短暂"冻住"效果 |
| 雷电 | ⚡ | 20% | 黄色闪电，全屏闪烁 |
| 星星 | ⭐ | 20% | 金色轨迹，连击时多颗星星 |
| 彩虹 | 🌈 | 10% | 稀有攻击，彩色粒子效果 |
| 炸弹 | 💣 | 5% | 稀有攻击，爆炸范围大（伤害+1） |

**连击武器升级：**
- 3连击起：武器发射数量 +1
- 5连击起：武器体积放大 1.2倍
- 10连击起：必出稀有武器（彩虹或炸弹）

### 3.4 战斗机制

#### 玩家攻击（答对题目）
1. 显示正确反馈（沿用现有的绿色 + 音效）
2. 发射武器动画（从答题区飞向怪兽，约0.5秒）
3. 怪兽受击动画 + 显示伤害数字（-1 或连击时 -2）
4. 怪兽血条减少（带动画过渡）
5. 更新连击计数器

#### 怪兽攻击（答错题目）
1. 显示错误反馈 + 正确答案
2. 怪兽攻击动画（前冲 + 发射攻击emoji）
3. 屏幕边缘闪红（受伤效果）
4. 玩家血条减少
5. 连击数清零
6. 短暂震动反馈（手机端）

#### 怪兽击败流程
1. 最后一击时播放特殊音效
2. 怪兽死亡动画（1-1.5秒）
3. 显示"关卡完成"提示
4. 短暂庆祝（纸屑+加分动画）
5. 2秒后自动进入下一关
6. 最终BOSS击败后进入结算页面

#### 游戏结束条件
- **胜利**：击败所有怪兽
- **失败**：玩家血量归零

### 3.5 数值设计（平衡调整后）

| 参数 | 简单 | 普通 | 困难 |
|------|------|------|------|
| 玩家初始HP | 5❤️ | 4❤️ | 3❤️ |
| 答错扣血 | 1 | 1 | 1 |
| 基础伤害 | 1 | 1 | 1 |
| 连击3+伤害 | 1 | 2 | 2 |
| 连击5+伤害 | 2 | 2 | 3 |
| 关卡数 | 4 | 4 | 6 |
| 总题目数（约） | 18 | 22 | 34 |
| 预计时长 | 3-4分钟 | 4-5分钟 | 6-8分钟 |

**血量恢复机制：**
- 连续答对 5 题：恢复 1❤️（上限不超过初始值）
- 击败BOSS（最后一关）：恢复 1❤️
- 每关卡开始时不自动恢复（保持紧张感）

### 3.6 视觉效果需求（CSS动画实现）

#### 必需动画
| 动画 | 实现方式 | 时长 |
|------|----------|------|
| 怪兽待机呼吸 | `@keyframes float` + `transform: translateY` | 2s循环 |
| 武器飞行 | `@keyframes fly` + `position absolute` | 0.4s |
| 怪兽受击抖动 | `@keyframes shake` | 0.3s |
| 伤害数字弹出 | `@keyframes damage-pop` + `opacity` | 0.6s |
| 血条变化 | `transition: width 0.3s` | 0.3s |
| 屏幕闪红 | 全屏overlay + `animation: flash-red` | 0.2s |
| 怪兽死亡 | `@keyframes death` (scale + rotate + opacity) | 1s |

#### 增强动画（优先级低）
- 连击数字放大动画
- 关卡过渡淡入淡出
- 怪兽攻击前摇动画

### 3.7 音效需求

复用现有音效系统，新增：
| 场景 | 音效类型 | 备注 |
|------|----------|------|
| 武器发射 | 短促"嗖"声 | 复用 `click` 音效 |
| 怪兽受击 | 复用 `correct` 音效 | - |
| 怪兽攻击 | 复用 `wrong` 音效 | - |
| 怪兽死亡 | 复用 `streak` 音效 | - |
| 最终胜利 | 复用 `complete` 音效 | - |
| 游戏失败 | 低沉下降音 | 新增 |

### 3.8 激励机制

#### 即时反馈
- 每次攻击显示伤害数字动画
- 连击时显示"连击x3!"等文字
- 稀有武器出现时有特殊提示

#### 关卡奖励
- 每关击败获得基础分数：关卡数 × 50
- 无伤通关额外奖励：+30分
- 全连击通关（从未断连）：+50分

#### 成就系统扩展
新增战斗模式专属成就：
| 成就ID | 名称 | 描述 | 图标 |
|--------|------|------|------|
| `battle_first_win` | 初战告捷 | 首次完成战斗模式 | ⚔️ |
| `battle_no_damage` | 毫发无损 | 无伤通关简单难度 | 🛡️ |
| `battle_speedrun` | 速战速决 | 3分钟内通关简单难度 | ⏱️ |
| `battle_dragon_slayer` | 屠龙勇士 | 击败火焰龙宝宝 | 🐲 |
| `battle_demon_king` | 魔王终结者 | 击败九九魔王（困难模式） | 👹 |
| `battle_10_combo` | 连击大师 | 战斗中达成10连击 | 🔥 |

### 3.9 用户流程

```
首页 → 点击"小九九速算" → 模式选择页（新增）
                              ↓
              ┌───────────────┴───────────────┐
              ↓                               ↓
         [经典模式]                      [战斗模式]
              ↓                               ↓
         现有答题流程                    难度选择
                                              ↓
                                         战斗开始
                                              ↓
                                    ┌────────┴────────┐
                                    ↓                 ↓
                                 胜利             失败
                                    ↓                 ↓
                              结算页面          失败提示
                                    ↓                 ↓
                           ┌───────┴───────┐    [重新挑战]
                           ↓               ↓         ↓
                      [再来一次]      [返回首页]   返回难度选择
```

### 3.10 失败与重试机制

**决定：失败后可立即重新挑战**

**失败页面内容：**
- 显示"挑战失败"提示
- 显示本次战绩（击败了几只怪兽、答对题数）
- 鼓励文案："差一点就成功了！再试一次？"
- 按钮：[重新挑战] [返回首页]

**重试规则：**
- 重新挑战从第一关开始
- 不扣除已获得的分数
- 错题仍然记录到错题本

### 3.11 模式共存策略

**决定：战斗模式与经典模式并存**

**实现方式：**
- 在"小九九速算"入口点击后，显示模式选择页
- 默认推荐战斗模式（新用户引导）
- 两种模式共享同一套题库
- 两种模式的正确率和错题本数据合并统计

**模式选择页设计：**
```
┌────────────────────────┐
│    选择训练模式        │
├────────────────────────┤
│  ┌──────────────────┐  │
│  │  ⚔️ 怪兽战斗    │  │
│  │  消灭怪兽，      │  │
│  │  拯救数学王国！  │  │
│  │      [推荐]      │  │
│  └──────────────────┘  │
│                        │
│  ┌──────────────────┐  │
│  │  📝 经典模式    │  │
│  │  专注练习，      │  │
│  │  稳步提升        │  │
│  └──────────────────┘  │
└────────────────────────┘
```

## 4. 技术方案

### 4.1 技术约束
- 纯 CSS + JavaScript 实现，不使用游戏引擎
- 保持 PWA 离线可用能力
- 怪兽和武器使用 emoji 实现
- 兼容 iOS Safari 和 Chrome

### 4.2 状态管理扩展
```javascript
// 新增战斗状态
App.battle = {
    mode: 'battle',          // 'classic' | 'battle'
    currentStage: 1,         // 当前关卡
    totalStages: 4,          // 总关卡数
    playerHP: 5,             // 玩家当前血量
    playerMaxHP: 5,          // 玩家最大血量
    monsterHP: 5,            // 当前怪兽血量
    monsterMaxHP: 5,         // 当前怪兽最大血量
    combo: 0,                // 当前连击数
    totalDamage: 0,          // 总伤害
    noDamageTaken: true,     // 是否无伤
    startTime: null,         // 开始时间
}
```

### 4.3 新增CSS类
```css
.battle-page { }
.monster-area { }
.monster-emoji { }
.monster-hp-bar { }
.weapon-area { }
.weapon { }
.player-hp-bar { }
.combo-counter { }
/* 动画类 */
.monster-idle { }
.monster-hit { }
.monster-attack { }
.monster-death { }
.weapon-fly { }
.damage-number { }
.screen-flash-red { }
```

### 4.4 新增JavaScript模块
```javascript
// battle.js - 战斗模式核心逻辑
const BattleMode = {
    init(),
    startBattle(difficulty),
    showMonster(stage),
    attack(damage),
    monsterAttack(),
    checkWin(),
    checkLose(),
    nextStage(),
    endBattle(isVictory),
    // 动画控制
    playWeaponAnimation(type),
    playMonsterHitAnimation(),
    playMonsterDeathAnimation(),
    // 工具函数
    getRandomWeapon(),
    calculateDamage(combo),
}
```

### 4.5 开发优先级

**P0 - 核心功能（第一版）**
- [ ] 基础战斗流程（答题→攻击→受击）
- [ ] 4关卡怪兽系统
- [ ] 简单的武器飞行动画
- [ ] 血条UI和变化动画
- [ ] 胜利/失败判定和页面

**P1 - 体验优化（第二版）**
- [ ] 连击伤害加成
- [ ] 血量恢复机制
- [ ] 怪兽死亡动画
- [ ] 关卡过渡动画
- [ ] 战斗专属成就

**P2 - 锦上添花（第三版）**
- [ ] 困难模式额外关卡
- [ ] 稀有武器特效
- [ ] 怪兽攻击动画
- [ ] 更丰富的音效

## 5. 待办事项清单

- [x] 确定怪兽形象 → 使用emoji
- [x] 确定武器选择功能 → 不需要，随机出现
- [x] 确定血量恢复机制 → 连续答对5题恢复1点
- [x] 确定失败重试机制 → 可以立即重新挑战
- [x] 确定模式共存策略 → 并存，新增模式选择页
- [ ] 设计模式选择页UI
- [ ] 开发战斗页面HTML结构
- [ ] 开发CSS动画
- [ ] 开发战斗逻辑JS
- [ ] 测试和平衡性调整

## 6. 风险与应对

| 风险 | 可能性 | 影响 | 应对措施 |
|------|--------|------|----------|
| 动画性能不足 | 中 | 体验卡顿 | 使用transform和opacity，避免重排 |
| 难度不平衡 | 高 | 太难/太简单 | 预留数值配置，便于调整 |
| 游戏化过头 | 低 | 分散学习注意力 | 保持答题为核心，动画简洁 |
| 低龄用户流失 | 中 | 太难不想玩 | 简单模式足够简单，失败时鼓励 |

## 7. 成功指标

| 指标 | 目标 | 衡量方式 |
|------|------|----------|
| 单次练习题数 | +30% | 对比战斗模式vs经典模式 |
| 每日活跃次数 | +20% | 统计每日练习次数 |
| 正确率提升 | +5% | 对比使用前后 |
| 用户主观反馈 | 好评 | 询问 Lorik 和 Kai |

---

## 评审记录

| 日期 | 评审人 | 意见 |
|------|--------|------|
| 2026-02-05 | 产品经理 (Claude) | 完成首轮评审，补充完整PRD内容 |

### 产品经理评审意见

#### 一、游戏机制适合性评估

**优点：**
1. "打怪"概念对8-10岁儿童具有天然吸引力，符合目标用户认知
2. 将答题转化为攻击，建立了清晰的因果关系
3. 连击机制与现有系统兼容，学习成本低

**改进建议：**
1. ~~原PRD未明确怪兽形象~~ 已补充emoji怪兽方案
2. 建议增加"怪兽会说话"的小设计（如受击时显示"哎呦！"），增强拟人感
3. 考虑后期增加"收集怪兽"功能，击败的怪兽可以收集到图鉴中

#### 二、难度曲线评估

**优点：**
1. 三档难度设计合理
2. 关卡递进（HP逐渐增加）有挑战性

**改进建议：**
1. ~~原数值设计所有难度怪兽HP相同~~ 已调整为递增
2. 简单模式玩家HP可考虑更高（5→6），降低挫败感
3. 建议第一关设置"教学关"，首次进入时有简单引导

#### 三、激励机制评估

**优点：**
1. 连击加成设计很好，鼓励连续正确
2. 血量恢复机制（答对5题恢复1点）平衡了惩罚感

**补充建议：**
1. ~~缺少关卡奖励~~ 已补充每关分数奖励
2. ~~缺少战斗专属成就~~ 已补充6个专属成就
3. 考虑增加"每日首胜奖励"，提高活跃度

#### 四、用户体验流程评估

**优点：**
1. 战斗流程清晰
2. 失败可重试设计人性化

**改进建议：**
1. ~~模式选择入口不明确~~ 已补充模式选择页设计
2. 建议在首页增加战斗模式的明显入口（可考虑用小红点提示"新"）
3. 结算页面应突出显示"击败的怪兽"，增强成就感

#### 五、可能遗漏的功能点

已在PRD中补充：
1. **模式选择页**：让用户选择战斗或经典模式
2. **失败页面详细设计**：包含战绩和鼓励文案
3. **关卡过渡动画**：避免场景切换生硬
4. **战斗专属成就系统**
5. **连击武器升级视觉效果**
6. **血量恢复的触发提示**

建议后续版本考虑：
1. **排行榜**：与好友比较通关时间/连击数
2. **怪兽图鉴**：收集已击败的怪兽
3. **自定义角色**：让孩子选择自己的战斗形象
4. **周挑战BOSS**：每周解锁特殊BOSS

#### 六、总体评价

本PRD在游戏化设计上方向正确，核心机制清晰。主要风险在于：
1. 动画开发工作量较大，需要控制范围
2. 数值平衡需要实际测试调整

建议采用**敏捷迭代**方式开发：
- 第一版聚焦P0核心功能，快速上线测试
- 根据Lorik和Kai的实际反馈调整数值和体验
- 逐步迭代P1、P2功能

**评审结论：可以进入开发阶段**
